"use strict";

// tslint:disable-next-line: interface-name
// tslint:disable-next-line: interface-name
// tslint:disable-next-line: interface-name
// tslint:disable-next-line: interface-name
// tslint:disable-next-line: interface-name
const namespace = "CurrieTechnologies.Blazor.WebAuthentication";
const publicKeyCredentials = new Map();

function base64ToUintArray(base64) {
  const binaryString = window.atob(base64);
  const len = binaryString.length;
  const bytes = new Uint8Array(len);

  for (let i = 0; i < len; i++) {
    bytes[i] = binaryString.charCodeAt(i);
  }

  return bytes;
}

function getCredentialTransportType(input) {
  switch (input) {
    case 0:
    default:
      return "usb";

    case 1:
      return "nfc";

    case 2:
      return "ble";

    case 3:
      return "internal";
  }
}

function getCredentialType(input) {
  switch (input) {
    case 0:
    default:
      return "public-key";

    case 1:
      return "password";

    case 2:
      return "federated";
  }
}

function getUserVerificationType(input) {
  if (input == null) {
    return undefined;
  }

  switch (input) {
    case 0:
    default:
      return "required";

    case 1:
      return "preferred";

    case 2:
      return "discouraged";
  }
}

function getAuthenticatorAttachmentType(input) {
  if (input == null) {
    return undefined;
  }

  switch (input) {
    case 0:
    default:
      return "platform";

    case 1:
      return "cross-platform";
  }
}

function getAttestationType(input) {
  if (input == null) {
    return undefined;
  }

  switch (input) {
    case 0:
    default:
      return "none";

    case 1:
      return "indirect";

    case 2:
      return "direct";
  }
}

function formatPublicKeyCredentialCreationOptions(input) {
  input.attestation = getAttestationType(input.attestation);
  input.pubKeyCredParams = input.pubKeyCredParams.map((pkcp) => ({
    alg: pkcp.alg,
    type: getCredentialType(pkcp),
  }));

  if (input.authenticatorSelection) {
    input.authenticatorSelection.authenticatorAttachment = getAuthenticatorAttachmentType(
      input.authenticatorSelection.authenticatorAttachment,
    );
    input.authenticatorSelection.userVerification = getUserVerificationType(
      input.authenticatorSelection.userVerification,
    );
  }

  if (input.excludeCredentials) {
    input.excludeCredentials = input.excludeCredentials.map((ec) => ({
      id: ec.id,
      transports: ec.transports
        ? ec.transports.map((t) => getCredentialTransportType(t))
        : undefined,
      type: getCredentialType(ec.type),
    }));
  }

  input.challenge = base64ToUintArray(input.challenge);
  input.user.id = base64ToUintArray(input.user.id);
  removeNulls(input);
  return input;
}

function removeNulls(obj) {
  const isArray = obj instanceof Array;

  for (const k in obj) {
    if (obj[k] === null) {
      isArray ? obj.splice(k, 1) : delete obj[k];
    } else if (typeof obj[k] === "object") {
      removeNulls(obj[k]);
    }
  }
}

function completeCreatePublicKey(requestId, credential) {
  DotNet.invokeMethodAsync(
    namespace,
    "CompleteCreatePublicKey",
    requestId,
    credential,
  );
}

window.CurrieTechnologies = window.CurrieTechnologies || {};
window.CurrieTechnologies.Blazor = window.CurrieTechnologies.Blazor || {};
window.CurrieTechnologies.Blazor.WebAuthentication =
  window.CurrieTechnologies.Blazor.WebAuthentication || {};
window.CurrieTechnologies.Blazor.WebAuthentication.PublicKeyCredential =
  window.CurrieTechnologies.Blazor.WebAuthentication.PublicKeyCredential || {};

window.CurrieTechnologies.Blazor.WebAuthentication.CreatePublicKey = async (
  requestId,
  options,
  domId,
) => {
  const betterOptions = formatPublicKeyCredentialCreationOptions(options);
  const credential = await window.navigator.credentials.create({
    publicKey: betterOptions,
  });
  publicKeyCredentials.set(domId, credential);
  completeCreatePublicKey(requestId, credential);
};

window.CurrieTechnologies.Blazor.WebAuthentication.PublicKeyCredential.GetClientExtensionResults = (
  domId,
) => {
  const credential = publicKeyCredentials.get(domId);

  if (credential === undefined) {
    return null;
  }

  return credential.getClientExtensionResults();
};

window.atob("");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9XZWJBdXRoZW50aWNhdGlvbi50cyJdLCJuYW1lcyI6WyJuYW1lc3BhY2UiLCJwdWJsaWNLZXlDcmVkZW50aWFscyIsIk1hcCIsImJhc2U2NFRvVWludEFycmF5IiwiYmFzZTY0IiwiYmluYXJ5U3RyaW5nIiwid2luZG93IiwiYXRvYiIsImxlbiIsImxlbmd0aCIsImJ5dGVzIiwiVWludDhBcnJheSIsImkiLCJjaGFyQ29kZUF0IiwiZ2V0Q3JlZGVudGlhbFRyYW5zcG9ydFR5cGUiLCJpbnB1dCIsImdldENyZWRlbnRpYWxUeXBlIiwiZ2V0VXNlclZlcmlmaWNhdGlvblR5cGUiLCJ1bmRlZmluZWQiLCJnZXRBdXRoZW50aWNhdG9yQXR0YWNobWVudFR5cGUiLCJnZXRBdHRlc3RhdGlvblR5cGUiLCJmb3JtYXRQdWJsaWNLZXlDcmVkZW50aWFsQ3JlYXRpb25PcHRpb25zIiwiYXR0ZXN0YXRpb24iLCJwdWJLZXlDcmVkUGFyYW1zIiwibWFwIiwicGtjcCIsImFsZyIsInR5cGUiLCJhdXRoZW50aWNhdG9yU2VsZWN0aW9uIiwiYXV0aGVudGljYXRvckF0dGFjaG1lbnQiLCJ1c2VyVmVyaWZpY2F0aW9uIiwiZXhjbHVkZUNyZWRlbnRpYWxzIiwiZWMiLCJpZCIsInRyYW5zcG9ydHMiLCJ0IiwiY2hhbGxlbmdlIiwidXNlciIsInJlbW92ZU51bGxzIiwib2JqIiwiaXNBcnJheSIsIkFycmF5IiwiayIsInNwbGljZSIsImNvbXBsZXRlQ3JlYXRlUHVibGljS2V5IiwicmVxdWVzdElkIiwiY3JlZGVudGlhbCIsIkRvdE5ldCIsImludm9rZU1ldGhvZEFzeW5jIiwiQ3VycmllVGVjaG5vbG9naWVzIiwiQmxhem9yIiwiV2ViQXV0aGVudGljYXRpb24iLCJQdWJsaWNLZXlDcmVkZW50aWFsIiwiQ3JlYXRlUHVibGljS2V5Iiwib3B0aW9ucyIsImRvbUlkIiwiYmV0dGVyT3B0aW9ucyIsIm5hdmlnYXRvciIsImNyZWRlbnRpYWxzIiwiY3JlYXRlIiwicHVibGljS2V5Iiwic2V0IiwiR2V0Q2xpZW50RXh0ZW5zaW9uUmVzdWx0cyIsImdldCIsImdldENsaWVudEV4dGVuc2lvblJlc3VsdHMiXSwibWFwcGluZ3MiOiI7O0FBRUE7QUFLQTtBQUtBO0FBS0E7QUFLQTtBQUtBLE1BQU1BLFNBQWlCLEdBQUcsNkNBQTFCO0FBRUEsTUFBTUMsb0JBQXNELEdBQUcsSUFBSUMsR0FBSixFQUEvRDs7QUFLQSxTQUFTQyxpQkFBVCxDQUEyQkMsTUFBM0IsRUFBMkM7QUFDekMsUUFBTUMsWUFBWSxHQUFHQyxNQUFNLENBQUNDLElBQVAsQ0FBWUgsTUFBWixDQUFyQjtBQUNBLFFBQU1JLEdBQUcsR0FBR0gsWUFBWSxDQUFDSSxNQUF6QjtBQUNBLFFBQU1DLEtBQUssR0FBRyxJQUFJQyxVQUFKLENBQWVILEdBQWYsQ0FBZDs7QUFDQSxPQUFLLElBQUlJLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdKLEdBQXBCLEVBQXlCSSxDQUFDLEVBQTFCLEVBQThCO0FBQzVCRixJQUFBQSxLQUFLLENBQUNFLENBQUQsQ0FBTCxHQUFXUCxZQUFZLENBQUNRLFVBQWIsQ0FBd0JELENBQXhCLENBQVg7QUFDRDs7QUFDRCxTQUFPRixLQUFQO0FBQ0Q7O0FBRUQsU0FBU0ksMEJBQVQsQ0FBb0NDLEtBQXBDLEVBQTJFO0FBQ3pFLFVBQVFBLEtBQVI7QUFDRSxTQUFLLENBQUw7QUFDQTtBQUNFLGFBQU8sS0FBUDs7QUFDRixTQUFLLENBQUw7QUFDRSxhQUFPLEtBQVA7O0FBQ0YsU0FBSyxDQUFMO0FBQ0UsYUFBTyxLQUFQOztBQUNGLFNBQUssQ0FBTDtBQUNFLGFBQU8sVUFBUDtBQVRKO0FBV0Q7O0FBRUQsU0FBU0MsaUJBQVQsQ0FDRUQsS0FERixFQUUyQztBQUN6QyxVQUFRQSxLQUFSO0FBQ0UsU0FBSyxDQUFMO0FBQ0E7QUFDRSxhQUFPLFlBQVA7O0FBQ0YsU0FBSyxDQUFMO0FBQ0UsYUFBTyxVQUFQOztBQUNGLFNBQUssQ0FBTDtBQUNFLGFBQU8sV0FBUDtBQVBKO0FBU0Q7O0FB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QU0sQ0FBQzJDLGtCQUFQLENBQTBCQyxNQUExQixDQUFpQ0MsaUJBQWpDLENBQW1ERSxlQUFuRCxHQUFxRSxPQUNuRVIsU0FEbUUsRUFFbkVTLE9BRm1FLEVBR25FQyxLQUhtRSxLQUloRTtBQUNILFFBQU1DLGFBQWEsR0FBR25DLHdDQUF3QyxDQUFDaUMsT0FBRCxDQUE5RDtBQUNBLFFBQU1SLFVBQVUsR0FBSSxNQUFPeEMsTUFBTSxDQUFDbUQsU0FBUCxDQUN4QkMsV0FEdUIsQ0FDY0MsTUFEZCxDQUNxQjtBQUM3Q0MsSUFBQUEsU0FBUyxFQUFFSjtBQURrQyxHQURyQixDQUExQjtBQUlBdkQsRUFBQUEsb0JBQW9CLENBQUM0RCxHQUFyQixDQUF5Qk4sS0FBekIsRUFBZ0NULFVBQWhDO0FBQ0FGLEVBQUFBLHVCQUF1QixDQUFDQyxTQUFELEVBQVlDLFVBQVosQ0FBdkI7QUFDRCxDQVpEOztBQWNBeEMsTUFBTSxDQUFDMkMsa0JBQVAsQ0FBMEJDLE1BQTFCLENBQWlDQyxpQkFBakMsQ0FBbURDLG1CQUFuRCxDQUF1RVUseUJBQXZFLEdBQ0VQLEtBRGlHLElBRTlGO0FBQ0gsUUFBTVQsVUFBVSxHQUFHN0Msb0JBQW9CLENBQUM4RCxHQUFyQixDQUF5QlIsS0FBekIsQ0FBbkI7O0FBQ0EsTUFBSVQsVUFBVSxLQUFLNUIsU0FBbkIsRUFBOEI7QUFDNUIsV0FBTyxJQUFQO0FBQ0Q7O0FBQ0QsU0FBTzRCLFVBQVUsQ0FBQ2tCLHlCQUFYLEVBQVA7QUFDRCxDQVJEOztBQVVBMUQsTUFBTSxDQUFDQyxJQUFQLENBQVksRUFBWiIsInNvdXJjZXNDb250ZW50IjpbIu+7v2RlY2xhcmUgdmFyIERvdE5ldDogYW55O1xyXG5cclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBpbnRlcmZhY2UtbmFtZVxyXG5pbnRlcmZhY2UgV2luZG93IHtcclxuICBDdXJyaWVUZWNobm9sb2dpZXM6IGFueTtcclxufVxyXG5cclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBpbnRlcmZhY2UtbmFtZVxyXG5pbnRlcmZhY2UgUHVibGljS2V5Q3JlZGVudGlhbCB7XHJcbiAgZ2V0Q2xpZW50RXh0ZW5zaW9uUmVzdWx0czogKCkgPT4gQXJyYXlCdWZmZXI7XHJcbn1cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogaW50ZXJmYWNlLW5hbWVcclxuaW50ZXJmYWNlIFB1YmxpY0tleUNyZWRlbnRpYWxQYXJhbWV0ZXJzIHtcclxuICB0eXBlOiBcInB1YmxpYy1rZXlcIiB8IFwicGFzc3dvcmRcIiB8IFwiZmVkZXJhdGVkXCI7XHJcbn1cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogaW50ZXJmYWNlLW5hbWVcclxuaW50ZXJmYWNlIFB1YmxpY0tleUNyZWRlbnRpYWxEZXNjcmlwdG9yIHtcclxuICB0eXBlOiBcInB1YmxpYy1rZXlcIiB8IFwicGFzc3dvcmRcIiB8IFwiZmVkZXJhdGVkXCI7XHJcbn1cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogaW50ZXJmYWNlLW5hbWVcclxuaW50ZXJmYWNlIEF1dGhlbnRpY2F0b3JTZWxlY3Rpb25Dcml0ZXJpYSB7XHJcbiAgdXNlclZlcmlmaWNhdGlvbjogXCJyZXF1aXJlZFwiIHwgXCJwcmVmZXJyZWRcIiB8IFwiZGlzY291cmFnZWRcIiB8IHVuZGVmaW5lZDtcclxufVxyXG5cclxuY29uc3QgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIkN1cnJpZVRlY2hub2xvZ2llcy5CbGF6b3IuV2ViQXV0aGVudGljYXRpb25cIjtcclxuXHJcbmNvbnN0IHB1YmxpY0tleUNyZWRlbnRpYWxzOiBNYXA8c3RyaW5nLCBQdWJsaWNLZXlDcmVkZW50aWFsPiA9IG5ldyBNYXA8XHJcbiAgc3RyaW5nLFxyXG4gIFB1YmxpY0tleUNyZWRlbnRpYWxcclxuPigpO1xyXG5cclxuZnVuY3Rpb24gYmFzZTY0VG9VaW50QXJyYXkoYmFzZTY0OiBzdHJpbmcpIHtcclxuICBjb25zdCBiaW5hcnlTdHJpbmcgPSB3aW5kb3cuYXRvYihiYXNlNjQpO1xyXG4gIGNvbnN0IGxlbiA9IGJpbmFyeVN0cmluZy5sZW5ndGg7XHJcbiAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShsZW4pO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgIGJ5dGVzW2ldID0gYmluYXJ5U3RyaW5nLmNoYXJDb2RlQXQoaSk7XHJcbiAgfVxyXG4gIHJldHVybiBieXRlcztcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q3JlZGVudGlhbFRyYW5zcG9ydFR5cGUoaW5wdXQ6IG51bWJlcik6IEF1dGhlbnRpY2F0b3JUcmFuc3BvcnQge1xyXG4gIHN3aXRjaCAoaW5wdXQpIHtcclxuICAgIGNhc2UgMDpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiBcInVzYlwiO1xyXG4gICAgY2FzZSAxOlxyXG4gICAgICByZXR1cm4gXCJuZmNcIjtcclxuICAgIGNhc2UgMjpcclxuICAgICAgcmV0dXJuIFwiYmxlXCI7XHJcbiAgICBjYXNlIDM6XHJcbiAgICAgIHJldHVybiBcImludGVybmFsXCI7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRDcmVkZW50aWFsVHlwZShcclxuICBpbnB1dDogbnVtYmVyLFxyXG4pOiBcInB1YmxpYy1rZXlcIiB8IFwicGFzc3dvcmRcIiB8IFwiZmVkZXJhdGVkXCIge1xyXG4gIHN3aXRjaCAoaW5wdXQpIHtcclxuICAgIGNhc2UgMDpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiBcInB1YmxpYy1rZXlcIjtcclxuICAgIGNhc2UgMTpcclxuICAgICAgcmV0dXJuIFwicGFzc3dvcmRcIjtcclxuICAgIGNhc2UgMjpcclxuICAgICAgcmV0dXJuIFwiZmVkZXJhdGVkXCI7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRVc2VyVmVyaWZpY2F0aW9uVHlwZShcclxuICBpbnB1dDogbnVtYmVyLFxyXG4pOiBcInJlcXVpcmVkXCIgfCBcInByZWZlcnJlZFwiIHwgXCJkaXNjb3VyYWdlZFwiIHwgdW5kZWZpbmVkIHtcclxuICBpZiAoaW5wdXQgPT0gbnVsbCkge1xyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIHN3aXRjaCAoaW5wdXQpIHtcclxuICAgIGNhc2UgMDpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiBcInJlcXVpcmVkXCI7XHJcbiAgICBjYXNlIDE6XHJcbiAgICAgIHJldHVybiBcInByZWZlcnJlZFwiO1xyXG4gICAgY2FzZSAyOlxyXG4gICAgICByZXR1cm4gXCJkaXNjb3VyYWdlZFwiO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0QXV0aGVudGljYXRvckF0dGFjaG1lbnRUeXBlKFxyXG4gIGlucHV0OiBudW1iZXIsXHJcbik6IFwicGxhdGZvcm1cIiB8IFwiY3Jvc3MtcGxhdGZvcm1cIiB8IHVuZGVmaW5lZCB7XHJcbiAgaWYgKGlucHV0ID09IG51bGwpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKGlucHV0KSB7XHJcbiAgICBjYXNlIDA6XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gXCJwbGF0Zm9ybVwiO1xyXG4gICAgY2FzZSAxOlxyXG4gICAgICByZXR1cm4gXCJjcm9zcy1wbGF0Zm9ybVwiO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0QXR0ZXN0YXRpb25UeXBlKFxyXG4gIGlucHV0OiBudW1iZXIsXHJcbik6IFwibm9uZVwiIHwgXCJpbmRpcmVjdFwiIHwgXCJkaXJlY3RcIiB8IHVuZGVmaW5lZCB7XHJcbiAgaWYgKGlucHV0ID09IG51bGwpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKGlucHV0KSB7XHJcbiAgICBjYXNlIDA6XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gXCJub25lXCI7XHJcbiAgICBjYXNlIDE6XHJcbiAgICAgIHJldHVybiBcImluZGlyZWN0XCI7XHJcbiAgICBjYXNlIDI6XHJcbiAgICAgIHJldHVybiBcImRpcmVjdFwiO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZm9ybWF0UHVibGljS2V5Q3JlZGVudGlhbENyZWF0aW9uT3B0aW9ucyhcclxuICBpbnB1dDogUHVibGljS2V5Q3JlZGVudGlhbENyZWF0aW9uT3B0aW9ucyxcclxuKTogUHVibGljS2V5Q3JlZGVudGlhbENyZWF0aW9uT3B0aW9ucyB7XHJcbiAgaW5wdXQuYXR0ZXN0YXRpb24gPSBnZXRBdHRlc3RhdGlvblR5cGUoKGlucHV0LmF0dGVzdGF0aW9uIGFzIGFueSkgYXMgbnVtYmVyKTtcclxuICBpbnB1dC5wdWJLZXlDcmVkUGFyYW1zID0gaW5wdXQucHViS2V5Q3JlZFBhcmFtcy5tYXAoKHBrY3ApID0+ICh7XHJcbiAgICBhbGc6IHBrY3AuYWxnLFxyXG4gICAgdHlwZTogZ2V0Q3JlZGVudGlhbFR5cGUoKHBrY3AgYXMgYW55KSBhcyBudW1iZXIpLFxyXG4gIH0pKTtcclxuXHJcbiAgaWYgKGlucHV0LmF1dGhlbnRpY2F0b3JTZWxlY3Rpb24pIHtcclxuICAgIGlucHV0LmF1dGhlbnRpY2F0b3JTZWxlY3Rpb24uYXV0aGVudGljYXRvckF0dGFjaG1lbnQgPSBnZXRBdXRoZW50aWNhdG9yQXR0YWNobWVudFR5cGUoXHJcbiAgICAgIChpbnB1dC5hdXRoZW50aWNhdG9yU2VsZWN0aW9uLmF1dGhlbnRpY2F0b3JBdHRhY2htZW50IGFzIGFueSkgYXMgbnVtYmVyLFxyXG4gICAgKTtcclxuXHJcbiAgICBpbnB1dC5hdXRoZW50aWNhdG9yU2VsZWN0aW9uLnVzZXJWZXJpZmljYXRpb24gPSBnZXRVc2VyVmVyaWZpY2F0aW9uVHlwZShcclxuICAgICAgKGlucHV0LmF1dGhlbnRpY2F0b3JTZWxlY3Rpb24udXNlclZlcmlmaWNhdGlvbiBhcyBhbnkpIGFzIG51bWJlcixcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBpZiAoaW5wdXQuZXhjbHVkZUNyZWRlbnRpYWxzKSB7XHJcbiAgICBpbnB1dC5leGNsdWRlQ3JlZGVudGlhbHMgPSBpbnB1dC5leGNsdWRlQ3JlZGVudGlhbHMubWFwKChlYykgPT4gKHtcclxuICAgICAgaWQ6IGVjLmlkLFxyXG4gICAgICB0cmFuc3BvcnRzOiBlYy50cmFuc3BvcnRzXHJcbiAgICAgICAgPyBlYy50cmFuc3BvcnRzLm1hcCgodCkgPT5cclxuICAgICAgICAgICAgZ2V0Q3JlZGVudGlhbFRyYW5zcG9ydFR5cGUoKHQgYXMgYW55KSBhcyBudW1iZXIpLFxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIDogdW5kZWZpbmVkLFxyXG4gICAgICB0eXBlOiBnZXRDcmVkZW50aWFsVHlwZSgoZWMudHlwZSBhcyBhbnkpIGFzIG51bWJlciksXHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBpbnB1dC5jaGFsbGVuZ2UgPSBiYXNlNjRUb1VpbnRBcnJheSgoaW5wdXQuY2hhbGxlbmdlIGFzIGFueSkgYXMgc3RyaW5nKTtcclxuXHJcbiAgaW5wdXQudXNlci5pZCA9IGJhc2U2NFRvVWludEFycmF5KChpbnB1dC51c2VyLmlkIGFzIGFueSkgYXMgc3RyaW5nKTtcclxuICByZW1vdmVOdWxscyhpbnB1dCk7XHJcbiAgcmV0dXJuIGlucHV0O1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVOdWxscyhvYmo6IGFueSkge1xyXG4gIGNvbnN0IGlzQXJyYXkgPSBvYmogaW5zdGFuY2VvZiBBcnJheTtcclxuICBmb3IgKGNvbnN0IGsgaW4gb2JqKSB7XHJcbiAgICBpZiAob2JqW2tdID09PSBudWxsKSB7XHJcbiAgICAgIGlzQXJyYXkgPyBvYmouc3BsaWNlKGssIDEpIDogZGVsZXRlIG9ialtrXTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mIG9ialtrXSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICByZW1vdmVOdWxscyhvYmpba10pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29tcGxldGVDcmVhdGVQdWJsaWNLZXkoXHJcbiAgcmVxdWVzdElkOiBzdHJpbmcsXHJcbiAgY3JlZGVudGlhbDogUHVibGljS2V5Q3JlZGVudGlhbCxcclxuKSB7XHJcbiAgRG90TmV0Lmludm9rZU1ldGhvZEFzeW5jKFxyXG4gICAgbmFtZXNwYWNlLFxyXG4gICAgXCJDb21wbGV0ZUNyZWF0ZVB1YmxpY0tleVwiLFxyXG4gICAgcmVxdWVzdElkLFxyXG4gICAgY3JlZGVudGlhbCxcclxuICApO1xyXG59XHJcblxyXG53aW5kb3cuQ3VycmllVGVjaG5vbG9naWVzID0gd2luZG93LkN1cnJpZVRlY2hub2xvZ2llcyB8fCB7fTtcclxud2luZG93LkN1cnJpZVRlY2hub2xvZ2llcy5CbGF6b3IgPSB3aW5kb3cuQ3VycmllVGVjaG5vbG9naWVzLkJsYXpvciB8fCB7fTtcclxud2luZG93LkN1cnJpZVRlY2hub2xvZ2llcy5CbGF6b3IuV2ViQXV0aGVudGljYXRpb24gPVxyXG4gIHdpbmRvdy5DdXJyaWVUZWNobm9sb2dpZXMuQmxhem9yLldlYkF1dGhlbnRpY2F0aW9uIHx8IHt9O1xyXG53aW5kb3cuQ3VycmllVGVjaG5vbG9naWVzLkJsYXpvci5XZWJBdXRoZW50aWNhdGlvbi5QdWJsaWNLZXlDcmVkZW50aWFsID1cclxuICB3aW5kb3cuQ3VycmllVGVjaG5vbG9naWVzLkJsYXpvci5XZWJBdXRoZW50aWNhdGlvbi5QdWJsaWNLZXlDcmVkZW50aWFsIHx8IHt9O1xyXG5cclxud2luZG93LkN1cnJpZVRlY2hub2xvZ2llcy5CbGF6b3IuV2ViQXV0aGVudGljYXRpb24uQ3JlYXRlUHVibGljS2V5ID0gYXN5bmMgKFxyXG4gIHJlcXVlc3RJZDogc3RyaW5nLFxyXG4gIG9wdGlvbnM6IFB1YmxpY0tleUNyZWRlbnRpYWxDcmVhdGlvbk9wdGlvbnMsXHJcbiAgZG9tSWQ6IHN0cmluZyxcclxuKSA9PiB7XHJcbiAgY29uc3QgYmV0dGVyT3B0aW9ucyA9IGZvcm1hdFB1YmxpY0tleUNyZWRlbnRpYWxDcmVhdGlvbk9wdGlvbnMob3B0aW9ucyk7XHJcbiAgY29uc3QgY3JlZGVudGlhbCA9IChhd2FpdCAod2luZG93Lm5hdmlnYXRvclxyXG4gICAgLmNyZWRlbnRpYWxzIGFzIENyZWRlbnRpYWxzQ29udGFpbmVyKS5jcmVhdGUoe1xyXG4gICAgcHVibGljS2V5OiBiZXR0ZXJPcHRpb25zLFxyXG4gIH0pKSBhcyBQdWJsaWNLZXlDcmVkZW50aWFsO1xyXG4gIHB1YmxpY0tleUNyZWRlbnRpYWxzLnNldChkb21JZCwgY3JlZGVudGlhbCk7XHJcbiAgY29tcGxldGVDcmVhdGVQdWJsaWNLZXkocmVxdWVzdElkLCBjcmVkZW50aWFsKTtcclxufTtcclxuXHJcbndpbmRvdy5DdXJyaWVUZWNobm9sb2dpZXMuQmxhem9yLldlYkF1dGhlbnRpY2F0aW9uLlB1YmxpY0tleUNyZWRlbnRpYWwuR2V0Q2xpZW50RXh0ZW5zaW9uUmVzdWx0cyA9IChcclxuICBkb21JZDogc3RyaW5nLFxyXG4pID0+IHtcclxuICBjb25zdCBjcmVkZW50aWFsID0gcHVibGljS2V5Q3JlZGVudGlhbHMuZ2V0KGRvbUlkKTtcclxuICBpZiAoY3JlZGVudGlhbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgcmV0dXJuIGNyZWRlbnRpYWwuZ2V0Q2xpZW50RXh0ZW5zaW9uUmVzdWx0cygpO1xyXG59O1xyXG5cclxud2luZG93LmF0b2IoXCJcIik7XHJcbiJdfQ==
